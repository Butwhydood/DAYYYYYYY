<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Library</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&family=Libre+Baskerville:ital,wght@0,400;0,700;1,400&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Libre Baskerville', serif;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 50%, #fab1a0 100%);
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }
        
        .pixelated-text {
            font-family: 'Press Start 2P', cursive;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        .background-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            opacity: 0.3;
        }
        
        .container {
            display: flex;
            min-height: 100vh;
            position: relative;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: linear-gradient(135deg, #f8e5d8 0%, #f5d5c0 100%);
            border-right: 2px solid #d4a574;
            padding: 20px;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        .sidebar-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .library-title {
            color: #8b6f47;
            font-size: 18px;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .library-subtitle {
            font-size: 11px;
            color: #a0826d;
            font-style: italic;
        }
        
        /* Sections List */
        .sections-container {
            margin-bottom: 20px;
        }
        
        .section-item {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        
        .section-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--section-color, #f0b27a);
            transition: width 0.3s ease;
        }
        
        .section-item:hover::before {
            width: 8px;
        }
        
        .section-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
        }
        
        .section-item.active {
            background: linear-gradient(135deg, #fff5e6 0%, #ffe0b2 100%);
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-name {
            font-size: 12px;
            font-weight: bold;
            color: #5d4e37;
        }
        
        .section-count {
            font-size: 10px;
            color: #a0826d;
            background: rgba(255,255,255,0.5);
            padding: 2px 8px;
            border-radius: 10px;
        }
        
        .section-icon {
            width: 30px;
            height: 30px;
            border-radius: 5px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
        }
        
        .add-section-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdbb 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 12px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .add-section-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        /* Main Content Area */
        .main-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: rgba(255,255,255,0.9);
            backdrop-filter: blur(10px);
        }
        
        .content-header {
            background: linear-gradient(135deg, #f8e5d8 0%, #f5d5c0 100%);
            padding: 20px 30px;
            border-bottom: 2px solid #d4a574;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .section-title {
            color: #5d4e37;
            font-size: 20px;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .icon-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
        }
        
        /* Books Grid */
        .books-container {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }
        
        .books-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 25px;
        }
        
        .book-card {
            background: linear-gradient(135deg, #fff 0%, #f9f9f9 100%);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            min-height: 250px;
            display: flex;
            flex-direction: column;
        }
        
        .book-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #f0b27a, #f7dc6f, #a8e6cf);
            border-radius: 15px 15px 0 0;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .book-card:hover::before {
            opacity: 1;
        }
        
        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .book-spine {
            width: 100%;
            height: 8px;
            background: linear-gradient(90deg, #d4a574 0%, #c19a6b 50%, #d4a574 100%);
            border-radius: 2px;
            margin-bottom: 15px;
        }
        
        .book-title {
            font-size: 14px;
            font-weight: bold;
            color: #5d4e37;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .book-author {
            font-size: 11px;
            color: #a0826d;
            margin-bottom: 15px;
            font-style: italic;
        }
        
        .book-preview {
            font-size: 11px;
            color: #7d6d5d;
            line-height: 1.6;
            flex: 1;
            display: -webkit-box;
            -webkit-line-clamp: 6;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .book-actions {
            display: flex;
            justify-content: flex-end;
            gap: 5px;
            margin-top: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .book-card:hover .book-actions {
            opacity: 1;
        }
        
        .small-btn {
            padding: 5px 10px;
            border: none;
            border-radius: 5px;
            font-size: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .delete-btn {
            background: #ffb3ba;
            color: #8b0000;
        }
        
        .delete-btn:hover {
            background: #ff9999;
        }
        
        .edit-btn {
            background: #bae1ff;
            color: #004080;
        }
        
        .edit-btn:hover {
            background: #a3d5ff;
        }
        
        /* Writing Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #fff8f0 0%, #fff5e6 100%);
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }
        
        .modal-header {
            background: linear-gradient(135deg, #f8e5d8 0%, #f5d5c0 100%);
            padding: 20px 30px;
            border-bottom: 2px solid #d4a574;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            color: #5d4e37;
            font-size: 18px;
        }
        
        .close-modal {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background: white;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .close-modal:hover {
            background: #ffb3ba;
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            color: #5d4e37;
            font-size: 12px;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e8d4c1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #d4a574;
        }
        
        /* Text Editor */
        .editor-toolbar {
            display: flex;
            gap: 5px;
            padding: 10px;
            background: white;
            border: 2px solid #e8d4c1;
            border-bottom: none;
            border-radius: 8px 8px 0 0;
            flex-wrap: wrap;
        }
        
        .editor-btn {
            padding: 8px 12px;
            border: 1px solid #e8d4c1;
            background: white;
            cursor: pointer;
            border-radius: 5px;
            transition: all 0.2s ease;
        }
        
        .editor-btn:hover {
            background: #f8e5d8;
        }
        
        .editor-btn.active {
            background: #d4a574;
            color: white;
        }
        
        .editor-content {
            width: 100%;
            min-height: 300px;
            padding: 20px;
            border: 2px solid #e8d4c1;
            border-radius: 0 0 8px 8px;
            font-size: 14px;
            line-height: 1.8;
            background: white;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 31px,
                    #e8d4c1 31px,
                    #e8d4c1 32px
                );
            resize: vertical;
        }
        
        .editor-content:focus {
            outline: none;
            border-color: #d4a574;
        }
        
        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #a8e6cf 0%, #7fcdbb 100%);
            border: none;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        /* Section Customization Modal */
        .color-picker {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.selected {
            border-color: #5d4e37;
            box-shadow: 0 0 0 2px white, 0 0 0 4px #5d4e37;
        }
        
        .icon-picker {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .icon-option {
            width: 50px;
            height: 50px;
            border: 2px solid #e8d4c1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
        }
        
        .icon-option:hover {
            background: #f8e5d8;
        }
        
        .icon-option.selected {
            background: #d4a574;
            border-color: #5d4e37;
        }
        
        /* Background Upload */
        .upload-section {
            padding: 20px;
            border: 2px dashed #d4a574;
            border-radius: 10px;
            text-align: center;
            margin-top: 20px;
        }
        
        .upload-label {
            display: inline-block;
            padding: 10px 20px;
            background: linear-gradient(135deg, #ffd89b 0%, #f7dc6f 100%);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #5d4e37;
            font-weight: bold;
        }
        
        .upload-label:hover {
            transform: scale(1.05);
        }
        
        input[type="file"] {
            display: none;
        }
        
        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #a0826d;
        }
        
        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-title {
            font-size: 18px;
            margin-bottom: 10px;
        }
        
        .empty-subtitle {
            font-size: 14px;
            font-style: italic;
        }
        
        /* View Book Modal */
        .view-modal {
            background: linear-gradient(135deg, #fff8f0 0%, #fff5e6 100%);
            border-radius: 20px;
            width: 90%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .paper-content {
            background: white;
            margin: 30px;
            padding: 40px;
            border-radius: 10px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.05);
            min-height: 400px;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 31px,
                    rgba(232, 212, 193, 0.3) 31px,
                    rgba(232, 212, 193, 0.3) 32px
                );
        }
        
        .view-title {
            font-size: 24px;
            color: #5d4e37;
            margin-bottom: 10px;
            text-align: center;
            font-weight: bold;
        }
        
        .view-author {
            font-size: 14px;
            color: #a0826d;
            text-align: center;
            font-style: italic;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e8d4c1;
        }
        
        .view-content {
            font-size: 16px;
            line-height: 2;
            color: #3d3d3d;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        /* Font size selector */
        .font-size-selector {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border: 1px solid #e8d4c1;
            border-radius: 5px;
        }

        .font-size-selector select {
            border: none;
            background: none;
            cursor: pointer;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                border-right: none;
                border-bottom: 2px solid #d4a574;
            }
            
            .books-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
.change-bg-btn {
  position: absolute;
  top: 15px;
  right: 15px;
  cursor: pointer;
  display: inline-block;
}

.ditto-icon {
  width: 50px;
  height: 50px;
  image-rendering: pixelated;
  transition: transform 0.2s ease;
  display: block;
  margin: 0 auto;
}

.ditto-icon:hover {
  transform: scale(1.1);
}

.change-bg-btn input {
  display: none;
}

/* Tooltip below the icon, horizontal but responsive */
.tooltip-text {
  visibility: hidden;
  opacity: 0;
  position: absolute;
  top: 60px; /* below Ditto GIF */
  left: 50%;
  transform: translateX(-50%);
  background: #5d4e37;
  color: white;
  font-size: 10px;
  padding: 6px 10px;
  border-radius: 5px;
  transition: opacity 0.2s ease;
  white-space: normal;       /* allow wrapping if needed */
  max-width: 200px;          /* keep it from being too wide */
  word-break: break-word;    /* break words if necessary */
  text-align: center;
  z-index: 10;
  font-family: 'Press Start 2P', cursive; /* pixelated font */
  box-shadow: 2px 2px 0 #2e1c0f; /* retro shadow */
}

/* Always show properly on hover */
.change-bg-btn:hover .tooltip-text {
  visibility: visible;
  opacity: 1;
}
.context-menu {
  position: absolute;
  display: none;
  background: #fff5e6;
  border: 2px solid #d4a574;
  border-radius: 8px;
  box-shadow: 4px 4px 0 #8b6f47;
  list-style: none;
  padding: 5px 0;
  z-index: 2000;
  font-family: 'Press Start 2P', cursive;
}

.context-menu li {
  padding: 8px 15px;
  cursor: pointer;
  font-size: 12px;
  color: #5d4e37;
}

.context-menu li:hover {
  background: #ffd180;
}



    </style>
</head>
<body>
    <div class="background-overlay" id="bgOverlay"></div>
    
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
<div class="sidebar-header" style="display:flex; align-items:center; justify-content:center; gap:10px;">
    <div style="text-align:center;">
        <h1 class="library-title pixelated-text">DIGITAL LIBRARY</h1>
        <p class="library-subtitle">Your Personal Collection</p>
    </div>

    <!-- Cleffa GIF on the right -->
    <img src="CLEFFA.gif" 
         alt="Pixel Cleffa" 
         width="60" 
         style="image-rendering: pixelated;">
</div>
            
            <div class="sections-container" id="sectionsContainer">
                <!-- Sections will be added here -->
            </div>
            
            <button class="add-section-btn pixelated-text" onclick="openSectionModal()">
                + NEW SECTION
            </button>
            

        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <header class="content-header">
                <h2 class="section-title pixelated-text" id="currentSectionTitle">Select a Section</h2>
                <div class="header-actions">
                    <button class="icon-btn" onclick="openBookModal()" id="addBookBtn" style="display:none;">
                        <img src="pencil.png" alt="Write" style="width:24px; height:24px; image-rendering: pixelated;">
                    </button>
                    <button class="icon-btn" onclick="editCurrentSection()" id="editSectionBtn" style="display:none;">
                        üé®
                    </button>
                    <button class="icon-btn" onclick="deleteCurrentSection()" id="deleteSectionBtn" style="display:none;">
                        üóëÔ∏è
                    </button>
                    
                </div>
                <!-- Change Background Icon (Ditto GIF) -->
<div class="change-bg-btn">
  <label for="bgUploadTop">
    <img src="ICONFILE.gif" alt="Change Background" class="ditto-icon">
    <span class="tooltip-text pixelated-text">Background Change</span>
  </label>
  <input type="file" id="bgUploadTop" accept="image/*" onchange="changeBackground(event)">
</div>

            </header>
            
            <div class="books-container">
                <div class="books-grid" id="booksGrid">

                </div>
            </div>
        </main>
    </div>
    
    <!-- Book Writing/Editing Modal -->
    <div class="modal" id="bookModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title pixelated-text" id="bookModalTitle">Write New Book</h3>
                <button class="close-modal" onclick="closeBookModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="bookForm">
                    <input type="hidden" id="bookId">
                    <div class="form-group">
                        <label>Title</label>
                        <input type="text" id="bookTitle" required placeholder="Enter book title...">
                    </div>
                    <div class="form-group">
                        <label>Author</label>
                        <input type="text" id="bookAuthor" required placeholder="Your name...">
                    </div>
                    <div class="form-group">
                        <label>Content</label>
                        <div class="editor-toolbar">
                            <button type="button" class="editor-btn" onclick="formatText('bold')"><b>B</b></button>
                            <button type="button" class="editor-btn" onclick="formatText('italic')"><i>I</i></button>
                            <button type="button" class="editor-btn" onclick="formatText('underline')"><u>U</u></button>
                            <div class="font-size-selector">
                                <span>Size:</span>
                                <select onchange="changeFontSize(this.value)">
                                    <option value="3">Normal</option>
                                    <option value="1">Small</option>
                                    <option value="2">Medium</option>
                                    <option value="4">Large</option>
                                    <option value="5">X-Large</option>
                                </select>
                            </div>
                        </div>
                        <div class="editor-content" contenteditable="true" id="bookContent"></div>
                    </div>
                    <button type="submit" class="submit-btn pixelated-text">SAVE BOOK</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Section Creation/Edit Modal -->
    <div class="modal" id="sectionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title pixelated-text" id="sectionModalTitle">Create New Section</h3>
                <button class="close-modal" onclick="closeSectionModal()">√ó</button>
            </div>
            <div class="modal-body">
                <form id="sectionForm">
                    <input type="hidden" id="sectionId">
                    <div class="form-group">
                        <label>Section Name</label>
                        <input type="text" id="sectionName" required placeholder="e.g., Fantasy, Poetry, Journals...">
                    </div>
                    <div class="form-group">
                        <label>Choose Color Theme</label>
                        <div class="color-picker" id="colorPicker">
                            <div class="color-option" style="background: #ffb3ba" data-color="#ffb3ba"></div>
                            <div class="color-option" style="background: #ffdfba" data-color="#ffdfba"></div>
                            <div class="color-option" style="background: #ffffba" data-color="#ffffba"></div>
                            <div class="color-option" style="background: #baffc9" data-color="#baffc9"></div>
                            <div class="color-option" style="background: #bae1ff" data-color="#bae1ff"></div>
                            <div class="color-option" style="background: #e0bbe4" data-color="#e0bbe4"></div>
                            <div class="color-option" style="background: #f0b27a" data-color="#f0b27a"></div>
                            <div class="color-option" style="background: #a8e6cf" data-color="#a8e6cf"></div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Choose Icon</label>
                        <div class="icon-picker" id="iconPicker">
                            <div class="icon-option" data-icon="üìö">üìö</div>
                            <div class="icon-option" data-icon="üìñ">üìñ</div>
                            <div class="icon-option" data-icon="‚ú®">‚ú®</div>
                            <div class="icon-option" data-icon="üåü">üåü</div>
                            <div class="icon-option" data-icon="üé®">üé®</div>
                            <div class="icon-option" data-icon="üå∏">üå∏</div>
                            <div class="icon-option" data-icon="üåô">üåô</div>
                            <div class="icon-option" data-icon="‚òÄÔ∏è">‚òÄÔ∏è</div>
                            <div class="icon-option" data-icon="üçÉ">üçÉ</div>
                            <div class="icon-option" data-icon="ü¶ã">ü¶ã</div>
                            <div class="icon-option" data-icon="üé≠">üé≠</div>
                            <div class="icon-option" data-icon="üîÆ">üîÆ</div>
                        </div>
                    </div>
                    <button type="submit" class="submit-btn pixelated-text">SAVE SECTION</button>
                </form>
            </div>
        </div>
    </div>
    
    <!-- View Book Modal -->
    <div class="modal" id="viewBookModal">
        <div class="view-modal modal-content">
            <div class="modal-header">
                <h3 class="modal-title pixelated-text">Reading Mode</h3>
                <button class="close-modal" onclick="closeViewModal()">√ó</button>
            </div>
            <div class="paper-content">
                <h1 class="view-title" id="viewTitle"></h1>
                <p class="view-author" id="viewAuthor"></p>
                <div class="view-content" id="viewContent"></div>
            </div>
        </div>
    </div>
    
    <script>
        // Data Structure
        let library = {
            sections: [],
            books: [],
            currentSection: null,
            backgroundImage: null
        };
        
        // Load data on startup
        window.addEventListener('DOMContentLoaded', () => {
            loadLibrary();
            setupColorPicker();
            setupIconPicker();
            setupBookForm();
            setupSectionForm();
        });
        
function loadLibrary() {
    const saved = localStorage.getItem('digitalLibrary');
    if (saved) {
        library = JSON.parse(saved);
        if (library.backgroundImage) {
            document.getElementById('bgOverlay').style.backgroundImage = `url(${library.backgroundImage})`;
        }
    } else {
        library = { sections: [], books: [], backgroundImage: null };
    }

    // Ensure "My First Collection" section exists
    let section = library.sections.find(s => s.name === 'My First Collection');
    if (!section) {
        const sectionId = Date.now();
        section = {
            id: sectionId,
            name: 'My First Collection',
            color: '#f0b27a',
            icon: 'üìö'
        };
        library.sections.push(section);

        // Add 18 example books (explicit style)
// Add 18 example books (explicit style)
library.books.push(
    {
        id: section.id + 1,
        sectionId: section.id,
        title: 'Welcome to Your Library',
        author: 'Library Creator',
        content: '<p><strong>Hello!</strong></p><p>This is your first book in the Digital Library. HELOOOOOOOOOOOOOOOOOOOOOOOOOOOO</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 2,
        sectionId: section.id,
        title: 'Getting Started',
        author: 'Library Guide',
        content: '<p>Here you can write stories, notes, or journals.</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 3,
        sectionId: section.id,
        title: 'Example Story',
        author: 'Demo Author',
        content: '<p>Once upon a time in a demo library...</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 4,
        sectionId: section.id,
        title: 'Tips & Tricks',
        author: 'Library Helper',
        content: '<p>Right-click anywhere to see your options and customize your library.</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 5,
        sectionId: section.id,
        title: 'Enjoy Writing!',
        author: 'Library Creator',
        content: '<p>Start adding your own books and sections to make this library truly yours.</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 6,
        sectionId: section.id,
        title: 'Organizing Sections',
        author: 'Library Guide',
        content: '<p>Use sections to sort your books by theme, topic, or style.</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 7,
        sectionId: section.id,
        title: 'Background Customization',
        author: 'Library Helper',
        content: '<p>You can change the background to make your library feel personal.</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 8,
        sectionId: section.id,
        title: 'Creating Stories',
        author: 'Story Weaver',
        content: '<p>Every great adventure begins with a single word‚Ä¶</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 9,
        sectionId: section.id,
        title: 'Daily Journaling',
        author: 'Mindful Writer',
        content: '<p>Use this space to reflect on your day and capture your thoughts.</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 10,
        sectionId: section.id,
        title: 'Poetry Corner',
        author: 'Dreamer',
        content: '<p>Words that rhyme, thoughts that shine ‚Äî let your heart speak.</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 11,
        sectionId: section.id,
        title: 'Study Notes',
        author: 'Student',
        content: '<p>Turn this library into your own digital notebook.</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 12,
        sectionId: section.id,
        title: 'Creative Writing',
        author: 'Imaginator',
        content: '<p>Experiment with new ideas, characters, and worlds.</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 13,
        sectionId: section.id,
        title: 'Library Rules',
        author: 'System',
        content: '<p>You can edit or delete these demo books anytime.</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 14,
        sectionId: section.id,
        title: 'Your First Draft',
        author: 'Coach',
        content: '<p>Don‚Äôt worry about being perfect. Just write!</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 15,
        sectionId: section.id,
        title: 'Inspirations',
        author: 'Muse',
        content: '<p>Keep a list of quotes, thoughts, and sparks of imagination.</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 16,
        sectionId: section.id,
        title: 'Reflection Log',
        author: 'Thinker',
        content: '<p>Look back on your progress and growth over time.</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 17,
        sectionId: section.id,
        title: 'Dream Journal',
        author: 'Sleeper',
        content: '<p>Write down your dreams the moment you wake up.</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    },
    {
        id: section.id + 18,
        sectionId: section.id,
        title: 'Final Words',
        author: 'Library Creator',
        content: '<p>Now it‚Äôs your turn. Start building your own collection!</p>',
        createdAt: new Date().toISOString(),
        updatedAt: new Date().toISOString()
    }
);

    }

    renderSections();
    renderHome();
    saveLibrary();
}
        
        function saveLibrary() {
            localStorage.setItem('digitalLibrary', JSON.stringify(library));
        }
        
        // Section Management
        function renderSections() {
            const container = document.getElementById('sectionsContainer');
            container.innerHTML = library.sections.map(section => {
                const bookCount = library.books.filter(b => b.sectionId === section.id).length;
                return `
                    <div class="section-item ${library.currentSection === section.id ? 'active' : ''}" 
                         onclick="selectSection(${section.id})"
                         style="--section-color: ${section.color}">
                        <div class="section-header">
                            <div>
                                <div class="section-icon">${section.icon}</div>
                                <div class="section-name">${section.name}</div>
                            </div>
                            <span class="section-count">${bookCount} books</span>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
function selectSection(sectionId) {
    library.currentSection = sectionId;
    const section = library.sections.find(s => s.id === sectionId);
    if (!section) return;

    document.getElementById('currentSectionTitle').textContent = section.name;
    ['addBookBtn', 'editSectionBtn', 'deleteSectionBtn'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'block';
    });

    // Hide Ditto inside
    const changeBtn = document.querySelector('.change-bg-btn');
    if (changeBtn) changeBtn.style.display = 'none';

    // Show back arrow
    const backArrow = document.getElementById('backArrow');
    if (backArrow) backArrow.style.display = 'inline';

    renderBooks();
    saveLibrary();
}
function renderHome() {
    const container = document.getElementById('booksGrid');
    if (!container) return;

    // Reset title + hide section-only buttons
    document.getElementById('currentSectionTitle').textContent = "üìö My Library";
    ['addBookBtn', 'editSectionBtn', 'deleteSectionBtn'].forEach(id => {
        const el = document.getElementById(id);
        if (el) el.style.display = 'none';
    });

    // Show Ditto only at home
    const changeBtn = document.querySelector('.change-bg-btn');
    if (changeBtn) changeBtn.style.display = 'block';

    // Sections ‚Üí cards
    if (!library.sections || library.sections.length === 0) {
        container.innerHTML = `
            <div class="book-card">
                <div class="book-spine"></div>
                <h3 class="book-title pixelated-text">No Sections Yet</h3>
                <p class="book-author">Right-click to create your first section</p>
            </div>
        `;
    } else {
        container.innerHTML = library.sections.map(section => `
            <div class="book-card" onclick="selectSection(${section.id})">
                <div class="book-spine"></div>
                <h3 class="book-title pixelated-text">${escapeHtml(section.name)}</h3>
                <p class="book-author">${library.books.filter(b => b.sectionId === section.id).length} books</p>
            </div>
        `).join('');
    }

    // Refresh sidebar
    if (typeof renderSections === 'function') renderSections();

    // Hide back arrow
    const backArrow = document.getElementById('backArrow');
    if (backArrow) backArrow.style.display = 'none';

    library.currentSection = null;
}

        
        function renderBooks() {
            const container = document.getElementById('booksGrid');
            const sectionBooks = library.books.filter(b => b.sectionId === library.currentSection);
            
            if (sectionBooks.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìù</div>
                        <h3 class="empty-title pixelated-text">No books yet</h3>
                        <p class="empty-subtitle">Click the ‚úçÔ∏è button to write your first book</p>
                    </div>
                `;
                return;


    // Hide the back arrow when on home
    document.getElementById('backArrow').style.display = 'none';
}



// Hide the back arrow when on home (if it exists)
const backArrow = document.getElementById('backArrow');
if (backArrow) backArrow.style.display = 'none';



            
            container.innerHTML = sectionBooks.map(book => `
                <div class="book-card" onclick="viewBook(${book.id})">
                    <div class="book-spine"></div>
                    <h3 class="book-title">${escapeHtml(book.title)}</h3>
                    <p class="book-author">by ${escapeHtml(book.author)}</p>
                    <p class="book-preview">${stripHtml(book.content).substring(0, 200)}...</p>
                    <div class="book-actions">
                        <button class="small-btn edit-btn" onclick="editBook(${book.id}, event)">Edit</button>
                        <button class="small-btn delete-btn" onclick="deleteBook(${book.id}, event)">Delete</button>
                    </div>
                </div>
            `).join('');
        }
        
        // Book Modal Functions
        function openBookModal(bookId = null) {
            const modal = document.getElementById('bookModal');
            const form = document.getElementById('bookForm');
            
            if (bookId) {
                const book = library.books.find(b => b.id === bookId);
                if (book) {
                    document.getElementById('bookModalTitle').textContent = 'Edit Book';
                    document.getElementById('bookId').value = book.id;
                    document.getElementById('bookTitle').value = book.title;
                    document.getElementById('bookAuthor').value = book.author;
                    document.getElementById('bookContent').innerHTML = book.content;
                }
            } else {
                document.getElementById('bookModalTitle').textContent = 'Write New Book';
                form.reset();
                document.getElementById('bookContent').innerHTML = '';
                document.getElementById('bookId').value = '';
            }
            
            modal.classList.add('active');
        }
        
        function closeBookModal() {
            document.getElementById('bookModal').classList.remove('active');
        }
        
        function editBook(bookId, event) {
            event.stopPropagation();
            openBookModal(bookId);
        }
        
        function deleteBook(bookId, event) {
            event.stopPropagation();
            if (confirm('Are you sure you want to delete this book?')) {
                library.books = library.books.filter(b => b.id !== bookId);
                saveLibrary();
                renderBooks();
            }
        }
        
        function viewBook(bookId) {
            const book = library.books.find(b => b.id === bookId);
            if (book) {
                document.getElementById('viewTitle').textContent = book.title;
                document.getElementById('viewAuthor').textContent = `by ${book.author}`;
                document.getElementById('viewContent').innerHTML = book.content;
                document.getElementById('viewBookModal').classList.add('active');
            }
        }
        
        function closeViewModal() {
            document.getElementById('viewBookModal').classList.remove('active');
        }
        
// Section Modal Functions
function openSectionModal(sectionId = null) {
    const modal = document.getElementById('sectionModal');
    const form = document.getElementById('sectionForm');
    
    if (sectionId) {
        const section = library.sections.find(s => s.id === sectionId);
        if (section) {
            document.getElementById('sectionModalTitle').textContent = 'Edit Section';
            document.getElementById('sectionId').value = section.id;
            document.getElementById('sectionName').value = section.name;
            
            // Select color and icon
            document.querySelectorAll('.color-option').forEach(el => {
                el.classList.toggle('selected', el.dataset.color === section.color);
            });
            document.querySelectorAll('.icon-option').forEach(el => {
                el.classList.toggle('selected', el.dataset.icon === section.icon);
            });
        }
    } else {
        document.getElementById('sectionModalTitle').textContent = 'Create New Section';
        form.reset();
        document.getElementById('sectionId').value = '';
        document.querySelectorAll('.color-option, .icon-option').forEach(el => {
            el.classList.remove('selected');
        });
    }
    
    modal.classList.add('active');
}
window.openSectionModal = openSectionModal; // üëà Add this

        
        function closeSectionModal() {
            document.getElementById('sectionModal').classList.remove('active');
        }
        
        function editCurrentSection() {
            if (library.currentSection) {
                openSectionModal(library.currentSection);
            }
        }
        
        function deleteCurrentSection() {
            if (!library.currentSection) return;
            
            if (confirm('Are you sure you want to delete this section and all its books?')) {
                // Delete all books in this section
                library.books = library.books.filter(b => b.sectionId !== library.currentSection);
                
                // Delete the section
                library.sections = library.sections.filter(s => s.id !== library.currentSection);
                
                // Reset current section
                library.currentSection = null;
                document.getElementById('currentSectionTitle').textContent = 'Select a Section';
                document.getElementById('addBookBtn').style.display = 'none';
                document.getElementById('editSectionBtn').style.display = 'none';
                document.getElementById('deleteSectionBtn').style.display = 'none';
                
                saveLibrary();
                renderSections();
                
                // Show empty state
                document.getElementById('booksGrid').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">üìö</div>
                        <h3 class="empty-title pixelated-text">Welcome to Your Library</h3>
                        <p class="empty-subtitle">Create a section to start organizing your books</p>
                    </div>
                `;
            }
        }
        
        // Form Handlers
        function setupBookForm() {
            document.getElementById('bookForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const bookId = document.getElementById('bookId').value;
                const title = document.getElementById('bookTitle').value;
                const author = document.getElementById('bookAuthor').value;
                const content = document.getElementById('bookContent').innerHTML;
                
                if (!library.currentSection) {
                    alert('Please select a section first');
                    return;
                }
                
                if (bookId) {
                    // Edit existing book
                    const book = library.books.find(b => b.id === parseInt(bookId));
                    if (book) {
                        book.title = title;
                        book.author = author;
                        book.content = content;
                        book.updatedAt = new Date().toISOString();
                    }
                } else {
                    // Create new book
                    const newBook = {
                        id: Date.now(),
                        sectionId: library.currentSection,
                        title: title,
                        author: author,
                        content: content,
                        createdAt: new Date().toISOString(),
                        updatedAt: new Date().toISOString()
                    };
                    library.books.push(newBook);
                }
                
                saveLibrary();
                renderBooks();
                renderSections();
                closeBookModal();
            });
        }
        
        function setupSectionForm() {
            document.getElementById('sectionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const sectionId = document.getElementById('sectionId').value;
                const name = document.getElementById('sectionName').value;
                const selectedColor = document.querySelector('.color-option.selected');
                const selectedIcon = document.querySelector('.icon-option.selected');
                
                const color = selectedColor ? selectedColor.dataset.color : '#f0b27a';
                const icon = selectedIcon ? selectedIcon.dataset.icon : 'üìö';
                
                if (sectionId) {
                    // Edit existing section
                    const section = library.sections.find(s => s.id === parseInt(sectionId));
                    if (section) {
                        section.name = name;
                        section.color = color;
                        section.icon = icon;
                    }
                } else {
                    // Create new section
                    const newSection = {
                        id: Date.now(),
                        name: name,
                        color: color,
                        icon: icon
                    };
                    library.sections.push(newSection);
                }
                
                saveLibrary();
                renderSections();
                closeSectionModal();
            });
        }
        
        // Color and Icon Pickers
        function setupColorPicker() {
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.color-option').forEach(el => el.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
        }
        
        function setupIconPicker() {
            document.querySelectorAll('.icon-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.icon-option').forEach(el => el.classList.remove('selected'));
                    this.classList.add('selected');
                });
            });
        }
        
        // Text Editor Functions
        function formatText(command) {
            document.execCommand(command, false, null);
            document.getElementById('bookContent').focus();
        }
        
        function changeFontSize(size) {
            document.execCommand('fontSize', false, size);
            document.getElementById('bookContent').focus();
        }
        
function changeBackground(event) {
    const file = event.target.files[0];
    if (file && file.type.startsWith('image/')) { // Changed this line
        const reader = new FileReader();
        reader.onload = function(e) {
            const imageUrl = e.target.result;
            document.getElementById('bgOverlay').style.backgroundImage = `url(${imageUrl})`;
            library.backgroundImage = imageUrl;
            saveLibrary();
        };
        reader.readAsDataURL(file);
    } else {
        alert('Please select an image file'); // Updated message
    }
}
        // Utility Functions
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        function stripHtml(html) {
            const tmp = document.createElement('div');
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || '';
        }
        
        // Close modals on ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal.active').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });
        
        // Close modals on outside click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.classList.remove('active');
                }
            });
            const contextMenu = document.getElementById('contextMenu');

document.querySelector('.books-container').addEventListener('contextmenu', (e) => {
    e.preventDefault();
    if (!library.currentSection) return; // only inside section
    contextMenu.style.top = e.pageY + 'px';
    contextMenu.style.left = e.pageX + 'px';
    contextMenu.style.display = 'block';
});

document.addEventListener('click', () => {
    contextMenu.style.display = 'none';
});
        });
        window.closeSectionModal = closeSectionModal;
window.openBookModal = openBookModal;
window.closeBookModal = closeBookModal;
window.editBook = editBook;
window.deleteBook = deleteBook;
window.viewBook = viewBook;
window.closeViewModal = closeViewModal;
window.editCurrentSection = editCurrentSection;
window.deleteCurrentSection = deleteCurrentSection;
window.formatText = formatText; 
window.changeFontSize = changeFontSize;
window.changeBackground = changeBackground;
window.selectSection = selectSection;
// === Custom Context Menu ===
window.addEventListener('DOMContentLoaded', () => {
    const contextMenu = document.getElementById('contextMenu');
    const mainContent = document.querySelector('.main-content');

    mainContent.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        contextMenu.innerHTML = "";

        if (!library.currentSection) {
            contextMenu.innerHTML = `
                <li onclick="openSectionModal()">‚ûï Create Section</li>
            `;
        } else {
            contextMenu.innerHTML = `
                <li onclick="openBookModal()">üìñ Create Book</li>
                <li onclick="document.getElementById('bgUploadTop').click()">üé® Change Section Background</li>
                <li onclick="editCurrentSection()">‚úèÔ∏è Edit Section</li>
                <li onclick="deleteCurrentSection()">üóëÔ∏è Delete Section</li>
            `;
        }

        contextMenu.style.top = e.pageY + "px";
        contextMenu.style.left = e.pageX + "px";
        contextMenu.style.display = "block";
    });

    document.addEventListener('click', () => {
        contextMenu.style.display = 'none';
    });
});


    </script>
<!-- Custom Context Menu -->
<ul id="contextMenu" class="context-menu">
  <li onclick="openBookModal()">üìñ Create Book</li>
  <li onclick="document.getElementById('bgUploadTop').click()">üé® Change Section Background</li>
  <li onclick="editCurrentSection()">‚úèÔ∏è Edit Section</li>
  <li onclick="deleteCurrentSection()">üóëÔ∏è Delete Section</li>
</ul>
</body>
</html> 




